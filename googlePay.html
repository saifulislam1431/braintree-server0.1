<!-- <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://js.braintreegateway.com/web/dropin/1.42.0/js/dropin.min.js"></script>
    <script src="https://pay.google.com/gp/p/js/pay.js" async defer></script>
</head>

<body style="display: flex; flex-direction: column;">
    <div id="dropin-container"></div>
    <button id="submit-button" class="paymentButton" style="display: none;"></button>
    <script>
        var button = document.querySelector('#submit-button');
        var clientToken = new URLSearchParams(window.location.search).get('client_token');
        var amount = new URLSearchParams(window.location.search).get('amount');

        braintree.dropin.create({
            authorization: clientToken,
            container: '#dropin-container',
            card: false,
            googlePay: {
                googlePayVersion: 2,
                merchantId: '378317447873447996', // Replace with your actual Google Pay merchant ID
                transactionInfo: {
                    totalPriceStatus: 'FINAL',
                    totalPrice: amount,
                    currencyCode: 'USD'
                },
                allowedPaymentMethods: [{
                    type: 'CARD',
                    parameters: {
                        billingAddressRequired: true,
                        billingAddressParameters: {
                            format: 'FULL'
                        }
                    }
                }]
            },

        }, function (createErr, instance) {
            if (createErr) {
                console.error('Create Error:', createErr);
                return;
            }
            button.addEventListener('click', function () {
                button.textContent = "Processing Payment";
                instance.requestPaymentMethod(function (requestPaymentMethodErr, payload) {
                    if (requestPaymentMethodErr) {
                        console.error('Request Payment Method Error:', requestPaymentMethodErr);
                        return;
                    }
                    // Collect device data
                    const deviceData = instance.deviceData;

                    // Send payload and device data to React Native to send to the server
                    window.ReactNativeWebView.postMessage(JSON.stringify({
                        nonce: payload.nonce,
                        deviceData: deviceData
                    }));
                });
            });
        });
    </script>
</body>

</html> -->

<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://pay.google.com/gp/p/js/pay.js" async defer></script>
    <script src="https://js.braintreegateway.com/web/3.102.0/js/client.min.js"></script>
    <script src="https://js.braintreegateway.com/web/3.102.0/js/google-payment.min.js"></script>
</head>

<body>
    <button id="google-pay-button" style="background-color: transparent; border: none;"></button>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const googlePayClient = new google.payments.api.PaymentsClient({ environment: 'TEST' });

            const isReadyToPayRequest = {
                apiVersion: 2,
                apiVersionMinor: 0,
                allowedPaymentMethods: [{
                    type: 'CARD',
                    parameters: {
                        allowedAuthMethods: ['PAN_ONLY', 'CRYPTOGRAM_3DS'],
                        allowedCardNetworks: ['MASTERCARD', 'VISA'],
                        billingAddressRequired: true,
                        billingAddressParameters: {
                            format: 'FULL',
                            phoneNumberRequired: true
                        }
                    }
                }]
            };

            googlePayClient.isReadyToPay(isReadyToPayRequest).then(function (response) {
                console.log('isReadyToPay response:', response);
                if (response.result) {
                    const button = googlePayClient.createButton({
                        onClick: onGooglePayButtonClicked
                    });
                    document.getElementById('google-pay-button').appendChild(button);
                } else {
                    console.error('Google Pay is not available.');
                }
            }).catch(function (err) {
                console.error('isReadyToPay error:', err);
            });

            function onGooglePayButtonClicked() {
                const amount = new URLSearchParams(window.location.search).get('amount');
                var clientToken = new URLSearchParams(window.location.search).get('client_token');

                const paymentDataRequest = {
                    apiVersion: 2,
                    apiVersionMinor: 0,
                    allowedPaymentMethods: [{
                        type: 'CARD',
                        parameters: {
                            allowedAuthMethods: ['PAN_ONLY', 'CRYPTOGRAM_3DS'],
                            allowedCardNetworks: ['MASTERCARD', 'VISA'],
                            billingAddressRequired: true,
                            billingAddressParameters: {
                                format: 'FULL',
                                phoneNumberRequired: true
                            }
                        },
                        tokenizationSpecification: {
                            type: 'PAYMENT_GATEWAY',
                            parameters: {
                                gateway: 'braintree',
                                'braintree:apiVersion': 'v1',
                                'braintree:merchantId': 'n9xd2ttx7p9zgpzk',
                                'braintree:clientKey': `${clientToken}` // Replace with your Braintree client token
                            }
                        }
                    }],
                    transactionInfo: {
                        totalPriceStatus: 'FINAL',
                        totalPrice: amount,
                        currencyCode: 'USD'
                    },
                    merchantInfo: {
                        merchantId: '378317447873447996',
                        merchantName: 'JurnyOn'
                    }
                };

                googlePayClient.loadPaymentData(paymentDataRequest).then(function (paymentData) {
                    processPayment(paymentData);
                }).catch(function (err) {
                    console.error('loadPaymentData error:', err);
                });
            }

            function processPayment(paymentData) {
                const paymentMethodData = paymentData.paymentMethodData;
                const token = paymentMethodData.tokenizationData.token;

                // Post message to React Native app
                window.ReactNativeWebView.postMessage(JSON.stringify({
                    nonce: token,
                    deviceData: paymentMethodData.tokenizationData.deviceData // Add device data if needed
                }));
            }
        });
    </script>
</body>

</html>