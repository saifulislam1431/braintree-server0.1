<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Google Pay</title>
    <script src="https://pay.google.com/gp/p/js/pay.js"></script>
    <script src="https://js.braintreegateway.com/web/3.78.3/js/client.min.js"></script>
    <script src="https://js.braintreegateway.com/web/3.78.3/js/google-payment.min.js"></script>
</head>

<body>
    <button id="google-pay-button">Pay with Google Pay</button>

    <script>
        var CLIENT_AUTHORIZATION = new URLSearchParams(window.location.search).get('client_token');
        var button = document.querySelector('#google-pay-button');
        var paymentsClient = new google.payments.api.PaymentsClient({
            environment: 'TEST' // Or 'PRODUCTION'
        });

        braintree.client.create({
            authorization: "sandbox_8h5x6mn9_hw6cx3qntbggh89h"
        }).then(function (clientInstance) {
            return braintree.googlePayment.create({
                client: clientInstance,
                googlePayVersion: 2,
                <!-- googleMerchantId: 'merchant-id-from-google' -->
            });
        }).then(function (googlePaymentInstance) {
            return paymentsClient.isReadyToPay({
                apiVersion: 2,
                apiVersionMinor: 0,
                allowedPaymentMethods: googlePaymentInstance.createPaymentDataRequest().allowedPaymentMethods,
                existingPaymentMethodRequired: true // Optional
            }).then(function (response) {
                if (response.result) {
                    button.addEventListener('click', function (event) {
                        event.preventDefault();

                        var paymentDataRequest = googlePaymentInstance.createPaymentDataRequest({
                            transactionInfo: {
                                currencyCode: 'USD',
                                totalPriceStatus: 'FINAL',
                                totalPrice: '100.00' // Your amount
                            }
                        });

                        var cardPaymentMethod = paymentDataRequest.allowedPaymentMethods[0];
                        cardPaymentMethod.parameters.billingAddressRequired = true;
                        cardPaymentMethod.parameters.billingAddressParameters = {
                            format: 'FULL',
                            phoneNumberRequired: true
                        };

                        paymentsClient.loadPaymentData(paymentDataRequest).then(function (paymentData) {
                            return googlePaymentInstance.parseResponse(paymentData);
                        }).then(function (result) {
                            window.ReactNativeWebView.postMessage(JSON.stringify({
                                nonce: result.nonce,
                                type: result.type,
                                billingAddress: paymentData.paymentMethodData.info.billingAddress
                            }));
                        }).catch(function (err) {
                            console.error('Google Pay Error:', err);
                        });
                    });
                }
            });
        }).catch(function (err) {
            console.error('Braintree Error:', err);
        });
    </script>
</body>

</html>